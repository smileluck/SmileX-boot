[toc]

---

# 前言

因为对低代码平台接触的比较多，但是这些平台的维护和更新，以及功能上的使用，有时并不满足需求，所以就想着自己做一套能方便扩展的平台。

# 架构升级

因为可能经常更新的原因，我把自己对架构演变的一个计划写在了这里，可以下载查看。

[架构演变](https://github.com/smileluck/geek-study/blob/main/job/week15/%E6%9E%B6%E6%9E%84%E6%BC%94%E5%8F%98.xmind)

# 一期

## 技术栈

- 框架
  - springboot
  - springmvc
  - springweb
- 安全
  - shiro
- 定时调度
  - xxljob (boot版本/cloud版本)
  - quartz (boot版本)
- 数据库
  - mysql
  - orm框架：mybatis + mybatis plus
  - 连接池：druid
- 缓存
  - redis
  - guava cache
- 工具
  - okhttp/restTemplate
  - guava
  - lombok



## 实现功能
- [ ] 系统管理
  - [ ] 登录注册
  - [ ] 用户管理
  - [ ] 角色管理
  - [ ] 菜单管理
  - [ ] 权限管理
    - [ ] shiro(主)
    - [ ] spring security（后面有时间在考虑）
  - [ ] 配置管理
  - [ ] 日志管理
    - [ ] 系统日志
    - [ ] 业务日志
  - [ ] 定时任务
  - [ ] api文档
  - [ ] 安全性
    - [ ] salt and pwd过滤
    - [ ] 敏感信息过滤
  - [ ] 数据字典
- [ ] 系统监控
  - [ ] mysql
  - [ ] redis
- [ ] 多租户
- [x] 多数据源
- [ ] 多语言管理
- [ ] 代码生成器
- [ ] 可视化报表
- [ ] 搜索引擎

## 数据库设计
暂时不考虑mysql以外的数据库，就以mysql为主，后续如果想引入其他类型的数据库，再考虑sql类型的兼容问题。
比如 mysql 的 tinyint 在其它数据库中不存在。

### 规约
> [参考阿里巴巴Java开发手册（嵩山版）](https://ucc-private-download.oss-cn-beijing.aliyuncs.com/66995068b45c4ebfa74afcfc2e76212c.pdf?Expires=1642170331&OSSAccessKeyId=LTAIvsP3ECkg4Nm9&Signature=HxCVjNaGK75%2BifAHdney%2FCn2H4k%3D)

- 基础规范
    1. 尽量使用innerDB存储引擎。Innodb 支持事务，支持行级锁，更好的恢复性，高并发下性能更好
    2. 使用utf8mb4字符集
    3. 需要添加注释
    4. 不要存储图片、文件等二进制数据。文件大 会导致数据量快速增长，数据库读取时，通常会进行大量的随机IO操作，操作会很耗时。最好只存储文件地址信息。
    5. 尽量做到冷热数据分离，减小表的宽度。MySQL限制每个表最多存储4096列，并且每一行数据的大小不能超过65535字节。减少磁盘IO,保证热数据的内存缓存命中率（表越宽，把表装载进内存缓冲池时所占用的内存也就越大,也会消耗更多的IO） 更有效的利用缓存，避免读入无用的冷数据经常一起使用的列放到一个表中
    6. 单表数据量超过500万行或者单表容量超过 2GB，才推荐进行分库分表。过大会造成修改表结构，备份，恢复都会有很大的问题，可以用历史数据归档（应用于日志数据），分库分表（应用于业务数据）等手段来控制数据量大小。
- 设计规范
    1. 主键：id,BigInt(20),唯一索引
    2. 外键字段命名：{【关联表名】去掉业务前缀}+“_”+ {关联字段名}，例如：order_id
    3. 区分位：*_flag,tinyint(1)【1是，0否#默认0】，mybatis会自动将tinyint(1)映射为Boolean类型
    4. 状态位: *_status,tinyint(2)/small(5),必须注释且注明每个值的意义【#默认1开始】
    5. 字段命名：多单词下划线分隔,user_id
    6. 小数类型：使用 decimal。
    7. varchar 是可变长字符串，不预先分配存储空间，长度不要超过 5000，如果存储长度大于此值，定义字段类型为 text，独立出来一张表，用主键来对应，避免影响其它字段索引效率。
    8. 不要使用is_开头,主要原因可以看看这个[文章](https://hollischuang.gitee.io/tobetopjavaer/#/basics/java-basic/success-isSuccess-and-boolean-Boolean)
    
- 建表要求
    - 建议在表中加入一下字段。
    ```sql
      # 建表sql
      `create_by` varchar(50) DEFAULT NULL COMMENT '创建人',
      `create_time` datetime DEFAULT NULL COMMENT '创建时间',
      `update_by` varchar(50) DEFAULT NULL COMMENT '更新人',
      `update_time` datetime DEFAULT NULL COMMENT '更新时间',
      `del_flag` tinyint(1) NOT NULL DEFAULT '0' COMMENT '1删除，0未删除',
    
      # 对现有表快速修改
      ALTER TABLE `表名`
      ADD COLUMN `create_by`  varchar(50) NULL COMMENT '创建人',
      ADD COLUMN `create_time`  datetime NULL COMMENT '创建时间' AFTER `create_by`,
      ADD COLUMN `update_by`  varchar(50) NULL COMMENT '更新人' AFTER `create_time`,
      ADD COLUMN `update_time`  datetime NULL COMMENT '更新时间' AFTER `update_by`,
      ADD COLUMN `del_flag`  tinyint(1) NULL COMMENT '1删除，0未删除' AFTER `update_time`;
    ```
    

### 表设计
- [ ] 系统管理（sys）
    - [ ] 系统用户(sys_user)
    

